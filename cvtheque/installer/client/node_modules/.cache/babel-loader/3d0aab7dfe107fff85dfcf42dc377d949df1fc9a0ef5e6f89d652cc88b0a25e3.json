{"ast":null,"code":"import { onBeforeMount, ref, computed } from 'vue';\nimport { APIService } from '@/core/util/services/api.service';\nimport InstallerTasks from '@/components/InstallerTasks.vue';\nimport useBeforeUnload from '@/core/util/composable/useBeforeUnload';\nimport useInstaller from '@/core/util/composable/useInstaller';\nimport { navigate } from '@/core/util/helper/navigation.ts';\nimport useProgress from '@/core/util/composable/useProgress';\nimport { OxdProgressbar } from '@ohrm/oxd';\nexport default {\n  name: 'InstallScreen',\n  components: {\n    'oxd-progress': OxdProgressbar,\n    'installer-tasks': InstallerTasks\n  },\n  setup() {\n    const errorText = ref(null);\n    const {\n      progress,\n      start,\n      stop,\n      end\n    } = useProgress();\n    const {\n      runCleanup,\n      runMigrations,\n      createInstance,\n      createDatabase,\n      createConfigFiles,\n      createDatabaseUser,\n      preMigrationCheck\n    } = useInstaller(new APIService(window.appGlobal.baseUrl, ''));\n    const tasks = ref([{\n      name: 'Database creation',\n      state: 0,\n      task: createDatabase\n    }, {\n      name: 'Checking database permissions',\n      state: 0,\n      task: preMigrationCheck\n    }, {\n      name: 'Applying database changes',\n      state: 0,\n      task: runMigrations\n    }, {\n      name: 'Instance and Admin user creation',\n      state: 0,\n      task: createInstance\n    }, {\n      name: 'Create OrangeHRM database user',\n      state: 0,\n      task: createDatabaseUser\n    }, {\n      name: 'Creating configuration files',\n      state: 0,\n      task: createConfigFiles\n    }]);\n    const onClickNext = () => {\n      navigate('/installer/complete');\n    };\n    const onClickCleanup = () => {\n      runCleanup().then(() => {\n        navigate('/installer/confirmation');\n      });\n    };\n    onBeforeMount(async () => {\n      start();\n      for (let index = 0; index < tasks.value.length; index++) {\n        try {\n          tasks.value[index].state = 1;\n          await tasks.value[index].task();\n          tasks.value[index].state = 2;\n        } catch (error) {\n          if (error?.message) {\n            errorText.value = error?.message;\n          }\n          tasks.value[index].state = 3;\n          stop();\n          break;\n        }\n        if (index === tasks.value.length - 1) end();\n      }\n    });\n    const progressText = computed(() => {\n      return `${Math.floor(progress.value)}%`;\n    });\n    const taskFailed = computed(() => {\n      return tasks.value.findIndex(task => task.state === 3) > -1;\n    });\n    const errorMessage = computed(() => taskFailed.value ? errorText.value ?? 'Installation has failed' : null);\n    const progressType = computed(() => {\n      return !taskFailed.value ? 'secondary' : 'error';\n    });\n    const overrideUnload = computed(() => {\n      return taskFailed.value || progress.value === 100;\n    });\n    useBeforeUnload(overrideUnload);\n    return {\n      tasks,\n      progress,\n      taskFailed,\n      progressType,\n      progressText,\n      errorMessage,\n      onClickCleanup,\n      onClickNext\n    };\n  },\n  data() {\n    return {\n      faqUrl: 'https://starterhelp.orangehrm.com/hc/en-us/categories/360002856800-FAQs'\n    };\n  }\n};","map":null,"metadata":{},"sourceType":"module","externalDependencies":[]}